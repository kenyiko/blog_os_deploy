<!doctype html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Philipp Oppermann">

    
        <link rel="canonical" href="https://os.phil-opp.com/" />
    
    <link href="/css/poole.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">

    <script async src="/js/main.js"></script>

    <title>Writing an OS in Rust</title>
</head>

<body>
    <div class="container content">
        <header class="masthead">
            <div style="position:relative">
                <h1 class="masthead-title">
                    <a href="https://os.phil-opp.com" title="Home">Writing an OS in Rust (Second Edition)</a>
                </h1>
                <p><small>Philipp&nbsp;Oppermann's&nbsp;blog</small></p>
                
            </div>
        </header>

        <main>



<div class="front-page-introduction">
    <p>
        This blog series creates a small operating system in the
        <a href="https://www.rust-lang.org/">Rust programming language</a>. Each post is a small tutorial and includes all
        needed code, so you can follow along if you like. The source code is also available in the corresponding
        <a href="https://github.com/phil-opp/blog_os">Github repository</a>.
    </p>
    <p>Latest post:
        
        <strong><a href="/heap-allocation/">Heap Allocation</a></strong>
    </p>
</div>

<div id="bare-bones" class="post-category bare-bones">Bare Bones</div>
<div class="posts bare-bones">
    
    <div>
        <h2 class="post-title"><a href="/freestanding-rust-binary/">A Freestanding Rust Binary</a></h2>
        <div class="post-summary">
            <p>The first step in creating our own operating system kernel is to create a Rust executable that does not link the standard library. This makes it possible to run Rust code on the <a href="https://en.wikipedia.org/wiki/Bare_machine">bare metal</a> without an underlying operating system.</p>

            <a class="read-more" href="/freestanding-rust-binary/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/minimal-rust-kernel/">A Minimal Rust Kernel</a></h2>
        <div class="post-summary">
            <p>In this post we create a minimal 64-bit Rust kernel for the x86 architecture. We build upon the <a href="https://os.phil-opp.com/freestanding-rust-binary/">freestanding Rust binary</a> from the previous post to create a bootable disk image, that prints something to the screen.</p>

            <a class="read-more" href="/minimal-rust-kernel/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/vga-text-mode/">VGA Text Mode</a></h2>
        <div class="post-summary">
            <p>The <a href="https://en.wikipedia.org/wiki/VGA-compatible_text_mode">VGA text mode</a> is a simple way to print text to the screen. In this post, we create an interface that makes its usage safe and simple, by encapsulating all unsafety in a separate module. We also implement support for Rust's <a href="https://doc.rust-lang.org/std/fmt/#related-macros">formatting macros</a>.</p>

            <a class="read-more" href="/vga-text-mode/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/testing/">Testing</a></h2>
        <div class="post-summary">
            <p>This post explores unit and integration testing in <code>no_std</code> executables. We will use Rust's support for custom test frameworks to execute test functions inside our kernel. To report the results out of QEMU, we will use different features of QEMU and the <code>bootimage</code> tool.</p>

            <a class="read-more" href="/testing/">read&nbsp;more…</a>
        </div>
    </div>

</div>

<div id="exceptions" class="post-category exceptions">Exceptions</div>
<div class="posts exceptions">
    
    <div>
        <h2 class="post-title"><a href="/cpu-exceptions/">CPU Exceptions</a></h2>
        <div class="post-summary">
            <p>CPU exceptions occur in various erroneous situations, for example when accessing an invalid memory address or when dividing by zero. To react to them we have to set up an <em>interrupt descriptor table</em> that provides handler functions. At the end of this post, our kernel will be able to catch <a href="http://wiki.osdev.org/Exceptions#Breakpoint">breakpoint exceptions</a> and to resume normal execution afterwards.</p>

            <a class="read-more" href="/cpu-exceptions/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/double-fault-exceptions/">Double Faults</a></h2>
        <div class="post-summary">
            <p>This post explores the double fault exception in detail, which occurs when the CPU fails to invoke an exception handler. By handling this exception we avoid fatal <em>triple faults</em> that cause a system reset. To prevent triple faults in all cases we also set up an <em>Interrupt Stack Table</em> to catch double faults on a separate kernel stack.</p>

            <a class="read-more" href="/double-fault-exceptions/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/hardware-interrupts/">Hardware Interrupts</a></h2>
        <div class="post-summary">
            <p>In this post we set up the programmable interrupt controller to correctly forward hardware interrupts to the CPU. To handle these interrupts we add new entries to our interrupt descriptor table, just like we did for our exception handlers. We will learn how to get periodic timer interrupts and how to get input from the keyboard.</p>

            <a class="read-more" href="/hardware-interrupts/">read&nbsp;more…</a>
        </div>
    </div>

</div>

<div id="memory-management" class="post-category memory-management">Memory Management</div>
<div class="posts memory-management">
    
    <div>
        <h2 class="post-title"><a href="/paging-introduction/">Introduction to Paging</a></h2>
        <div class="post-summary">
            <p>This post introduces <em>paging</em>, a very common memory management scheme that we will also use for our operating system. It explains why memory isolation is needed, how <em>segmentation</em> works, what <em>virtual memory</em> is, and how paging solves memory fragmentation issues. It also explores the layout of multilevel page tables on the x86_64 architecture.</p>

            <a class="read-more" href="/paging-introduction/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/paging-implementation/">Paging Implementation</a></h2>
        <div class="post-summary">
            <p>This post shows how to implement paging support in our kernel. It first explores different techniques to make the physical page table frames accessible to the kernel and discusses their respective advantages and drawbacks. It then implements an address translation function and a function to create a new mapping.</p>

            <a class="read-more" href="/paging-implementation/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/heap-allocation/">Heap Allocation</a></h2>
        <div class="post-summary">
            <p>This post adds support for heap allocation to our kernel. First, it gives an introduction to dynamic memory and shows how the borrow checker prevents common allocation errors. It then implements the basic allocation interface of Rust, creates a heap memory region, and sets up an allocator crate. At the end of this post all the allocation and collection types of the built-in <code>alloc</code> crate will be available to our kernel.</p>

            <a class="read-more" href="/heap-allocation/">read&nbsp;more…</a>
        </div>
    </div>

</div>

<div class="posts subscribe">
    <h2 class="post-title">Subscribe</h2>
    <p>Receive notifications about new posts and other major changes! You can either:</p>

    <p><ul>
        <li>Subscribe to our <a href="/rss.xml">RSS/Atom Feed</a>,</li>
        <li>Subscribe to <a href="https://github.com/phil-opp/blog_os/issues/479">this GitHub issue</a>, or</li>
        <li>Subscribe to our <a href="https://tinyletter.com/phil-opp/">email newsletter</a>.</li>
    </ul></p>
</div>

<div class="posts first-edition">
    <h2 class="post-title">First Edition</h2>
    You are viewing the second edition of “Writing an OS in Rust”, which is still in progress. The <a href="https://os.phil-opp.com/first-edition">first edition</a> has more content, but is no longer updated. We try our best to incorporate the missing content soon.
</div>

<hr>

<div class="frontpage-section">
    
    <h1>Extra Content</h1>
    <ul>
        
        
            <li><a href="/red-zone/">Disable the Red Zone</a></li>
        
            <li><a href="/disable-simd/">Disable SIMD</a></li>
        
            <li><a href="/second-edition/extra/building-on-android/">Building on Android</a></li>
        
    </ul>
</div>

<div class="frontpage-section">
    <h1>Status Updates</h1>
    
    <p>These posts give a regular overview of the most important changes to the blog and the tools and libraries behind the scenes.</p>
    <ul>
        
            <li><b><a href="/status-update/2019-10-06/">Updates in September 2019</a></b></li>
        
            <li><b><a href="/status-update/2019-09-09/">Updates in August 2019</a></b></li>
        
            <li><b><a href="/status-update/2019-08-02/">Updates in July 2019</a></b></li>
        
        <li><a href="https://os.phil-opp.com/status-update/"><em>view all »</em></a></li>
    </ul>
</div>

<div class="frontpage-section">
    <h1>Support Me</h1>
    <p>
    While creating this blog and the libraries and tools behind the scenes takes a lot of time, I really enjoy it and I'm committed to keep working on it. By supporting me, you allow me to invest more time into new content, new features, and continuous maintainance.
</p>
<p>
    The best way to support me is to <a href="https://github.com/sponsors/phil-opp"><em>sponsor me on GitHub</em></a>. GitHub will even match sponsorships until October 2020! If you prefer other platforms, I also have <a href="https://www.patreon.com/phil_opp"><em>Patreon</em></a> and <a href="https://donorbox.org/phil-opp"><em>Donorbox</em></a> accounts. The latter is the most flexible as it supports multiple currencies and one-time contributions.
</p>
<p>
    Thank you!
</p>
</div>

<aside id="recent-updates">
    <div class="block">
        <h2>Recent Updates</h2>
        <ul>
</ul>
    </div>

    <div class="block">
        <h2>Repository</h2>
        <div class="gh-repo-box">
            <div>
                <svg viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"></path></svg>
                <a href="https://github.com/phil-opp/blog_os" class="repo-link">
                    <span title="blog_os">phil-opp/blog_os</span>
                </a>
            </div>

            <p class="subtitle">
                Writing an OS in Rust
            </p>

            <p class="stars-forks">
                <a href="https://github.com/phil-opp/blog_os/stargazers" class="stars">
                    <svg aria-label="stars" viewBox="0 0 14 16" version="1.1" width="14" height="16" role="img"><path fill-rule="evenodd" d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74L14 6z"></path></svg>
                    4.0k
                </a>
                <a href="https://github.com/phil-opp/blog_os/network/members" class="forks">
                    <svg aria-label="forks" viewBox="0 0 10 16" version="1.1" width="10" height="16" role="img"><path fill-rule="evenodd" d="M8 1a1.993 1.993 0 0 0-1 3.72V6L5 8 3 6V4.72A1.993 1.993 0 0 0 2 1a1.993 1.993 0 0 0-1 3.72V6.5l3 3v1.78A1.993 1.993 0 0 0 5 15a1.993 1.993 0 0 0 1-3.72V9.5l3-3V4.72A1.993 1.993 0 0 0 8 1zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3 10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3-10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
                    349
                </a>

                <a href="https://github.com/sponsors/phil-opp" class="sponsor" href="#support-me">
                    <svg viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M9 2c-.97 0-1.69.42-2.2 1-.51.58-.78.92-.8 1-.02-.08-.28-.42-.8-1-.52-.58-1.17-1-2.2-1-1.632.086-2.954 1.333-3 3 0 .52.09 1.52.67 2.67C1.25 8.82 3.01 10.61 6 13c2.98-2.39 4.77-4.17 5.34-5.33C11.91 6.51 12 5.5 12 5c-.047-1.69-1.342-2.913-3-3z"></path></svg>
                    Sponsor
                </a>
            </p>
        </div>
    </div>

</aside>

</main>

        <div></div>

        <footer class="footer">
            <hr>
            <small>
                &copy; <time datetime="2019">2019</time>. All rights reserved.
                <a href="https://os.phil-opp.com/contact/">Contact</a>
            </small>
        </footer>
    </div>

    <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
    <script>
        (function(f, a, t, h, o, m){
            a[h]=a[h]||function(){
                (a[h].q=a[h].q||[]).push(arguments)
            };
            o=f.createElement('script'),
            m=f.getElementsByTagName('script')[0];
            o.async=1; o.src=t; o.id='fathom-script';
            m.parentNode.insertBefore(o,m)
        })(document, window, '//fathom.phil-opp.com/tracker.js', 'fathom');
        fathom('set', 'siteId', 'MUXWM');
        fathom('trackPageview');
    </script>
    <!-- / Fathom -->
</body>

</html>
